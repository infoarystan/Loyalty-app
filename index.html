[13:31, 20.12.2025] –û–ª—å–≥–∞: <!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Loyalty App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
    body { font-family: -apple-system, sans-serif; background: #f4f4f9; margin: 0; height: 100vh; display: flex; align-items: center; justify-content: center; }
    #staff-view, #client-view { display: none; text-align: center; width: 90%; max-width: 360px; }
    .staff-btn { width: 220px; height: 220px; border-radius: 50%;‚Ä¶
[13:35, 20.12.2025] –û–ª—å–≥–∞: <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Loyalty App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f4f9; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #app { text-align: center; width: 90%; max-width: 360px; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .balance { font-size: 52px; font-weight: bold; color: #28a745; margin: 10px 0; }
        .staff-btn { width: 200px; height: 200px; border-radius: 50%; background: #007AFF; color: white; border: none; font-size: 20px; font-weight: bold; cursor: pointer; }
        #qrcode { margin: 20px auto; display: flex; justify-content: center; }
        #timer { color: #888; font-size: 14px; }
    </style>
</head>
<body>
    <div id="app">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <script>
        const tg = window.Telegram.WebApp;
        
        function main() {
            try {
                tg.expand();
                const user = tg.initDataUnsafe?.user;
                const STAFF_IDS = [627287121];
                const SECRET_KEY = "SECRET";

                if (!user) {
                    document.getElementById('app').innerHTML = '<h3>–û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram</h3>';
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏
                if (STAFF_IDS.includes(user.id)) {
                    // –ò–ù–¢–ï–†–§–ï–ô–° –ö–ê–°–°–ò–†–ê
                    document.getElementById('app').innerHTML = `
                        <button class="staff-btn" id="scan-btn">üì∑<br>–°–ö–ê–ù–ò–†–û–í–ê–¢–¨</button>
                        <p style="margin-top:20px; opacity:0.6;">–†–µ–∂–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</p>
                    `;
                    document.getElementById('scan-btn').onclick = () => {
                        tg.showScanQrPopup({ text: "–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ QR –∫–ª–∏–µ–Ω—Ç–∞" }, (data) => {
                            if (data) {
                                [span_6](start_span)tg.sendData(data); // –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ[span_6](end_span)
                            }
                        });
                    };
                } else {
                    // –ò–ù–¢–ï–†–§–ï–ô–° –ö–õ–ò–ï–ù–¢–ê
                    const bal = tg.initDataUnsafe?.start_param || "0";
                    document.getElementById('app').innerHTML = `
                        <div class="card">
                            <h2>${user.first_name}</h2>
                            <div class="balance">${bal}</div>
                            <div id="qrcode"></div>
                            <div id="timer">–ö–æ–¥ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 60 —Å–µ–∫</div>
                        </div>
                    `;
                    startQR(user.id, SECRET_KEY);
                }
            } catch (err) {
                document.getElementById('app').innerHTML = <div style="color:red">–û—à–∏–±–∫–∞: ${err.message}</div>;
            }
        }

        function startQR(uid, key) {
            let timeLeft = 60;
            const gen = () => {
                const ts = Math.floor(Date.now() / 1000);
                const nonce = Math.random().toString(36).substring(2, 10);
                const sign = CryptoJS.HmacSHA256(uid + ts + nonce, key).toString().substring(0, 12);
                const payload = JSON.stringify({u:uid, t:ts, n:nonce, s:sign});
                
                const qrDiv = document.getElementById("qrcode");
                qrDiv.innerHTML = "";
                new QRCode(qrDiv, { text: payload, width: 220, height: 220, correctLevel: QRCode.CorrectLevel.M });
                timeLeft = 60;
            };
            gen();
            setInterval(gen, 60000);
            setInterval(() => {
                timeLeft--;
                if (timeLeft >= 0) document.getElementById("timer").innerText = –ö–æ–¥ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ${timeLeft} —Å–µ–∫;
            }, 1000);
        }

        // –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TG
        tg.ready();
        main();
    </script>
</body>
</html>