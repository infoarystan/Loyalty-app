[14:29, 20.12.2025] –û–ª—å–≥–∞: <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Loyalty</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #f0f2f5;
            height: 100vh;
            overflow-x: hidden;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) en‚Ä¶
[14:38, 20.12.2025] –û–ª—å–≥–∞: <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Loyalty App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f4f4f9; margin:0; display:flex; justify-content:center; align-items:center; height:100vh; }
        #staff-view, #client-view { display: none; text-align:center; width:90%; max-width:350px; }
        .staff-btn { width:220px; height:220px; border-radius:50%; background:linear-gradient(135deg,#007AFF,#0056b3); color:white;‚Ä¶
[14:43, 20.12.2025] –û–ª—å–≥–∞: <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Loyalty App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f4f4f9; margin:0; display:flex; justify-content:center; align-items:center; height:100vh; overflow: hidden; }
        #staff-view, #client-view { display: none; text-align:center; width:90%; max-width:350px; }
        .staf‚Ä¶
[14:49, 20.12.2025] –û–ª—å–≥–∞: <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Loyalty App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f4f4f9; margin:0; display:flex; justify-content:center; align-items:center; height:100vh; overflow: hidden; }
        #staff-view, #client-view { display: none; text-align:center; width:90%; max-width:350px; }
        .staf‚Ä¶
[14:57, 20.12.2025] –û–ª—å–≥–∞: <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Loyalty App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f4f9; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden;}
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –æ–±–∞ —ç–∫—Ä–∞–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        #staff-screen, #client-screen { display: none; width: 90%; max-width: 350px; text-align: center; }
        
        /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –∫–∞—Å—Å–∏—Ä–∞ */
        .staff-btn { width: 220px; height: 220px; border-radius: 50%; background: #007AFF; color: white; border: none; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 8px 20px rgba(0,122,255,0.3); }
        
        /* –°—Ç–∏–ª–∏ –∫–∞—Ä—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ */
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .balance { font-size: 50px; font-weight: bold; color: #28a745; margin: 10px 0; }
        #qrcode { margin: 20px auto; display: flex; justify-content: center; }
        #timer { color: #888; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="staff-screen">
        <button class="staff-btn" onclick="openScanner()">üì∑<br>–°–ö–ê–ù–ò–†–û–í–ê–¢–¨</button>
        <p style="margin-top:20px; opacity:0.6;">–†–µ–∂–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</p>
    </div>

    <div id="client-screen" class="card">
        <h2 id="username">–ì–æ—Å—Ç—å</h2>
        <p style="color:#888; margin:0;">–í–∞—à–∏ –±–∞–ª–ª—ã</p>
        <div class="balance" id="balance">0</div>
        <div id="qrcode"></div>
        <div id="timer">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // 1. –ù–ê–°–¢–†–û–ô–ö–ò
        const STAFF_IDS = [627287121]; // –¢–≤–æ–π ID
        const SECRET_KEY = "MY_SECRET_KEY"; 
        const user = tg.initDataUnsafe?.user;

        // 2. –ì–õ–ê–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ó–ê–ü–£–°–ö–ê
        if (!user) {
            document.body.innerHTML = "<h3 style='text-align:center'>–û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram</h3>";
        } else {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º: –ö–∞—Å—Å–∏—Ä –∏–ª–∏ –Ω–µ—Ç?
            if (STAFF_IDS.includes(user.id)) {
                // –ï—Å–ª–∏ –∫–∞—Å—Å–∏—Ä -> –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û —ç–∫—Ä–∞–Ω –∫–∞—Å—Å–∏—Ä–∞
                document.getElementById('staff-screen').style.display = 'block';
            } else {
                // –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç -> –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û —ç–∫—Ä–∞–Ω –∫–ª–∏–µ–Ω—Ç–∞
                document.getElementById('client-screen').style.display = 'block';
                initClientApp(); // –ó–∞–ø—É—Å–∫–∞–µ–º –ª–æ–≥–∏–∫—É –∫–ª–∏–µ–Ω—Ç–∞ (–±–∞–ª–ª—ã, QR)
            }
        }

        // --- –§–£–ù–ö–¶–ò–Ø –ö–ê–°–°–ò–†–ê (–°–ö–ê–ù–ï–†) ---
        function openScanner() {
            tg.showScanQrPopup({ text: '–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ QR –∫–ª–∏–µ–Ω—Ç–∞' }, (data) => {
                if (data) {
                    tg.closeScanQrPopup(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–º–µ—Ä—É
                    tg.sendData(data);     // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
                }
            });
        }

        // --- –§–£–ù–ö–¶–ò–Ø –ö–õ–ò–ï–ù–¢–ê (QR –ò –ë–ê–õ–õ–´) ---
        function initClientApp() {
            // 1. –ò–º—è –∏ –ë–∞–ª–∞–Ω—Å
            document.getElementById('username').innerText = user.first_name;
            const startParam = tg.initDataUnsafe?.start_param || "0";
            document.getElementById('balance').innerText = startParam;

            // 2. –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ QR
            let timeLeft = 30;
            const updateQR = () => {
                // –°–æ–∑–¥–∞–µ–º –∑–∞—â–∏—â–µ–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å
                const ts = Math.floor(Date.now() / 1000);
                const hash = CryptoJS.HmacSHA256(user.id + ts, SECRET_KEY).toString(CryptoJS.enc.Hex).substring(0, 10);
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º JSON
                const qrData = JSON.stringify({u: user.id, t: ts, s: hash});

                // –†–∏—Å—É–µ–º
                const qrDiv = document.getElementById("qrcode");
                qrDiv.innerHTML = "";
                new QRCode(qrDiv, { 
                    text: qrData, 
                    width: 200, 
                    height: 200, 
                    correctLevel: QRCode.CorrectLevel.M 
                });
                timeLeft = 30;
            };

            updateQR(); // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —Å—Ä–∞–∑—É
            setInterval(updateQR, 30000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
            
            // –¢–∞–π–º–µ—Ä –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
            setInterval(() => {
                timeLeft--;
                if (timeLeft >= 0) document.getElementById('timer').innerText = –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ${timeLeft} —Å–µ–∫;
            }, 1000);
        }
    </script>
</body>
</html>